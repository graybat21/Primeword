<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.prime.mappers.studyMapper">

	<select id="wordList" parameterType="Study" resultType="Study">
		select no, word, meaning from WORDTEST2
		where GRADE = #{grade} and TEXTBOOK = #{textbook} and LESSON = #{lesson}
	</select>

	<select id="howManyLesson" parameterType="Study" resultType="int">
		select max(lesson) from WORDTEST2
    	where grade = #{grade} and TEXTBOOK = #{textbook}
	</select>

	<select id="textbookListByGrade" parameterType="String" resultType="String">
		select distinct textbook from WORDTEST2
		where grade = #{grade}
	</select>
	
	<select id="wordsList" parameterType="hashmap" resultType="Study">
		select 
    		* 
    	from 
    		(SELECT (@row_number:=@row_number+1) as row_number,
    				no, word, meaning, grade, textbook, lesson
    		from WORDTEST2, (SELECT @row_number:=0) as t
          	<if test="searchKeyword != null || searchKeyword == ''">
    		where ${searchOption} like '%${searchKeyword}%'
  			</if>
  			order by no desc
    		) X
    	WHERE X.row_number BETWEEN #{first} and #{last}
	</select>
	<select id="wordsListCnt" resultType="int" parameterType="hashmap">
    	select count(*) from WORDTEST2
 		<if test="searchKeyword != null || searchKeyword == ''">
   		where ${searchOption} like '%${searchKeyword}%'
		</if>
    </select>
    <insert id="wordInsert" parameterType="Study">
    	insert into WORDTEST2(word, meaning, grade, textbook, lesson) 
    	VALUES(#{word}, #{meaning}, #{grade}, #{textbook}, #{lesson})
    </insert>
    <delete id="wordDelete" parameterType="int">
    	delete from WORDTEST2 where no = #{no}
    </delete>
    
	<!-- 그룹별 단어리스트 -->
    <select id="wordsGroupListCnt" resultType="int" parameterType="hashmap">
    	select count(distinct grade, textbook, lesson) from WORDTEST2
 		<if test="searchKeyword != null || searchKeyword == ''">
   		where ${searchOption} like '%${searchKeyword}%'
		</if>
    </select>
    <select id="wordsGroupList" parameterType="hashmap" resultType="Study">
		SELECT 
			grade, textbook, lesson 
		FROM (    
    		SELECT 
    			(@row_number:=@row_number+1) AS row_number, grade, textbook, lesson
    		FROM ( 
    			SELECT 
    				DISTINCT grade, textbook, lesson
    			FROM WORDTEST2
    			<if test="searchKeyword != null || searchKeyword == ''">
		   		WHERE ${searchOption} like '%${searchKeyword}%'
				</if>
   			) X, (SELECT @row_number:=0) AS t
        ) XX
        WHERE XX.row_number BETWEEN #{first} and #{last}
	</select>
    <delete id="wordsGroupDelete" parameterType="Study">
    	delete from WORDTEST2 
    	where grade = #{grade} and textbook = #{textbook} and lesson = #{lesson}
    </delete>
    
	<!-- 검색 추가기능 미구현 -->
	<select id="gradeList" resultType="String">
		select distinct grade from WORDTEST2 
	</select>
	<select id="textbookList" resultType="String" parameterType="hashmap">
		select dictinct textbook from WORDTEST2 
		where grade = #{grade}
	</select>
	<select id="lessonList" resultType="String" parameterType="hashmap">
		select dictinct lesson from WORDTEST2 
		where grade = #{grade} and textbook = #{textbook}
	</select>
	
	
</mapper>


